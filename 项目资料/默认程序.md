

## 默认程序的实现

dde-session-daemon/mime提供读写默认程序的dbus接口。

dde-session-daemon/mime 通过glib-gio来实现读写，默认程序的配置在多个配置文件，有优先级：

```shell
# 1 最高优先级，如果这里有就不看其他地方
～/.config/mimeapps.list 
# 2
XDG_CONFIG_DIR or /etc/xdg目下 
# 3
/usr/share/applications/mimeapps.list 和/usr/share/applications/mimeinfo.cache
```

命令行mime命令：

```shell
xdg-mime default xxx.desktop text/plain   # 命令行设置默认程序方法
xdg-mime query default text/plain       # 命令行查询默认程序
```



应用的desktop如果有MimeType字段，跟根据该字段的类型，自动在mimeinfo.cache生成指定类型与该应用的关联信息，

控制中心的默认程序列表通过mime获取，如果某应用没有MimeType字段，那么该应用不会在默认程序列表显示。



## 默认程序的类型

应用类型及其编码：

```
浏览器
get:"x-scheme-handler/http"
euler：org.deepin.browser.desktop

邮件
get:"x-scheme-handler/mailto"
set:
   array [
      string "x-scheme-handler/mailto"
      string "message/rfc822"
      string "application/x-extension-eml"
      string "application/x-xpinstall"
   ]
   string "deepin-mail.desktop"
euler：无

文本
get:"text/plain"
set:
   array [
      string "text/plain"
   ]
   string "deepin-editor.desktop"
euler：deepin-editor.desktop

音乐
get:"audio/mpeg"
set:
 array [
      string "audio/mpeg"
      string "audio/mp3"
      string "audio/x-mp3"
      string "audio/mpeg3"
      string "audio/x-mpeg-3"
      string "audio/x-mpeg"
      string "audio/flac"
      string "audio/x-flac"
      string "application/x-flac"
      string "audio/ape"
      string "audio/x-ape"
      string "application/x-ape"
      string "audio/ogg"
      string "audio/x-ogg"
      string "audio/musepack"
      string "application/musepack"
      string "audio/x-musepack"
      string "application/x-musepack"
      string "audio/mpc"
      string "audio/x-mpc"
      string "audio/vorbis"
      string "audio/x-vorbis"
      string "audio/x-wav"
      string "audio/x-ms-wma"
   ]
   string "deepin-music.desktop"
euler：无



视频
get:"video/mp4"
set:
 array [
      string "video/mp4"
      string "audio/mp4"
      string "audio/x-matroska"
      string "video/x-matroska"
      string "application/x-matroska"
      string "video/avi"
      string "video/msvideo"
      string "video/x-msvideo"
      string "video/ogg"
      string "application/ogg"
      string "application/x-ogg"
      string "video/3gpp"
      string "video/3gpp2"
      string "video/flv"
      string "video/x-flv"
      string "video/x-flic"
      string "video/mpeg"
      string "video/x-mpeg"
      string "video/x-ogm"
      string "application/x-shockwave-flash"
      string "video/x-theora"
      string "video/quicktime"
      string "video/x-ms-asf"
      string "application/vnd.rn-realmedia"
      string "video/x-ms-wmv"
   ]
   string "deepin-movie.desktop"
euler：无

图片
get:"image/jpeg"
set:
  array [
      string "image/jpeg"
      string "image/pjpeg"
      string "image/bmp"
      string "image/x-bmp"
      string "image/png"
      string "image/x-png"
      string "image/tiff"
      string "image/svg+xml"
      string "image/x-xbitmap"
      string "image/gif"
      string "image/x-xpixmap"
      string "image/vnd.microsoft.icon"
   ]
   string "deepin-image-viewer.desktop"
euler：deepin-image-viewer.desktop

终端(特殊,实际设置在xsetting，而不是mime)
get:"application/x-terminal"
set:
   array [
      string "application/x-terminal"
   ]
   string "deepin-terminal.desktop"
euler：deepin-terminal.desktop
```















