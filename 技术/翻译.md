

1，需要翻译的文案的代码处理

QObject::tr("Allow")



2， 根据代码生成文案文档

```shell
cd ${ProjectRoot}
mkdir translations
cd translations
lupdate -no-obsolete ../src/ -ts xxx_en_US.ts
```



3，transifex-client工具上传文案

- 安装工具

sudo apt install transifex-client

- 生成tx配置

（如果项目下有.tx/可省略这一步，如果项目下有.transifexrc则属于错误用法，可删掉项目下的.transifexrc，用home目录的）

在项目根目录下，输入tx init命令，输入api token（ 1/2847330938c2eebc627c8dd113ba4f58aeb3fd3d），会自动创建.transifexrc和.tx/config这2个隐藏文件；

复制配置文件到home目录下    mv .transifexrc ~；

- 配置.tx/config





5, 用脚本把ts生成qm

translate_generation.sh

```shell
#!/bin/bash
# this file is used to auto-generate .qm file from .ts file.
# author: shibowen at linuxdeepin.com

ts_list=(`ls translations/*.ts`)

for ts in "${ts_list[@]}"
do
    printf "\nprocess ${ts}\n"
    lrelease "${ts}"
done

```



6，qm的安装路径

cmake版：

```
execute_process(COMMAND bash "translate_generation.sh"
                    WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})
file(GLOB QM_FILES "translations/*.qm")
install(FILES ${QM_FILES} DESTINATION share/xxx/translations)
```



5，代码加载翻译qm

```
QTranslator translator;
translator.load("/usr/share/xxx/translations/xxx_" + QLocale::system().name());
app.installTranslator(&translator);
```





翻译 desktop 或者policy 的方法

先用deepin-ts-tools转为ts（参考https://docsin.uniontech.com/?p=8989）



https://shimo.im/sheets/H8x6dWrtRKy9hJXj/jlLQ9

https://shimo.im/docs/wjDJXWQRdPddtgQc/read

文案国际化的一些说明 https://shimo.im/docs/WY36RCpgHcJjhR6T/read